(()=>{var e={};e.id=255,e.ids=[255],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12518:e=>{"use strict";e.exports=require("mongodb")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48378:(e,r,t)=>{"use strict";t.d(r,{J:()=>u,N:()=>i});var s=t(43205),n=t.n(s);let o=process.env.JWT_SECRET;if(!o)throw Error("JWT_SECRET is not set. Add it to .env.local and restart.");function i(e,r="7d"){return n().sign(e,o,{expiresIn:r})}function u(e){try{return n().verify(e,o)}catch{return null}}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75745:(e,r,t)=>{"use strict";t.d(r,{Lf:()=>u,M:()=>a});var s=t(12518);let n=process.env.MONGODB_URI;if(!n)throw Error("MONGODB_URI is not set. Add it to .env.local and restart.");let o=global;async function i(){return o.mongoClientPromise||(o.mongoClientPromise=new s.MongoClient(n).connect()),o.mongoClientPromise}async function u(e=process.env.MONGODB_DB||"allegroscore"){return(await i()).db(e)}async function a(e="files"){let r=await u();return new s.GridFSBucket(r,{bucketName:e})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},91640:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>l,serverHooks:()=>f,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>d});var n=t(96559),o=t(48088),i=t(37719),u=t(32190),a=t(48378),c=t(75745),p=t(12518);async function d(e){let r=e.cookies.get("auth_token")?.value,t=r?(0,a.J)(r):null;if(!t?.sub)return u.NextResponse.json({error:"unauthorized"},{status:401});let{sheetMusicId:s}=await e.json();if(!s)return u.NextResponse.json({error:"missing-id"},{status:400});let n=await (0,c.Lf)();return await n.collection("users").updateOne({_id:new p.ObjectId(t.sub)},{$addToSet:{purchaseHistory:s}}),u.NextResponse.json({ok:!0})}let l=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/users/purchases/route",pathname:"/api/users/purchases",filename:"route",bundlePath:"app/api/users/purchases/route"},resolvedPagePath:"D:\\Programming\\AllegroScore\\src\\app\\api\\users\\purchases\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:g,serverHooks:f}=l;function v(){return(0,i.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:g})}},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[719,580,205],()=>t(91640));module.exports=s})();