(()=>{var e={};e.id=673,e.ids=[673],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12518:e=>{"use strict";e.exports=require("mongodb")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48378:(e,r,t)=>{"use strict";t.d(r,{J:()=>u,N:()=>i});var s=t(43205),n=t.n(s);let o=process.env.JWT_SECRET;if(!o)throw Error("JWT_SECRET is not set. Add it to .env.local and restart.");function i(e,r="7d"){return n().sign(e,o,{expiresIn:r})}function u(e){try{return n().verify(e,o)}catch{return null}}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67880:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>l});var n=t(96559),o=t(48088),i=t(37719),u=t(32190),a=t(48378),c=t(75745);async function l(e){let r=e.cookies.get("auth_token")?.value;if(!r)return u.NextResponse.json({user:null});let s=(0,a.J)(r);if(!s?.sub)return u.NextResponse.json({user:null});let n=(await (0,c.Lf)()).collection("users"),o=await n.findOne({_id:new(await Promise.resolve().then(t.t.bind(t,12518,23))).ObjectId(s.sub)});return o?u.NextResponse.json({user:{id:o._id?.toString(),email:o.email,role:"sanirud.perera@gmail.com"===o.email?"admin":o.role??"customer",purchaseHistory:o.purchaseHistory??[]}}):u.NextResponse.json({user:null})}let p=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/me/route",pathname:"/api/auth/me",filename:"route",bundlePath:"app/api/auth/me/route"},resolvedPagePath:"D:\\Programming\\AllegroScore\\src\\app\\api\\auth\\me\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:x}=p;function g(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},75745:(e,r,t)=>{"use strict";t.d(r,{Lf:()=>u,M:()=>a});var s=t(12518);let n=process.env.MONGODB_URI;if(!n)throw Error("MONGODB_URI is not set. Add it to .env.local and restart.");let o=global;async function i(){return o.mongoClientPromise||(o.mongoClientPromise=new s.MongoClient(n).connect()),o.mongoClientPromise}async function u(e=process.env.MONGODB_DB||"allegroscore"){return(await i()).db(e)}async function a(e="files"){let r=await u();return new s.GridFSBucket(r,{bucketName:e})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[719,580,205],()=>t(67880));module.exports=s})();