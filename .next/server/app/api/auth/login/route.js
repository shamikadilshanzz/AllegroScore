(()=>{var e={};e.id=758,e.ids=[758],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12518:e=>{"use strict";e.exports=require("mongodb")},19607:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>x,serverHooks:()=>h,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{POST:()=>g});var i=t(96559),n=t(48088),o=t(37719),a=t(32190),u=t(75745),c=t(70762),l=t(85665),p=t.n(l),d=t(48378);let m=c.z.object({email:c.z.string().email(),password:c.z.string().min(6)});async function g(e){let r=m.safeParse(await e.json());if(!r.success)return a.NextResponse.json({error:"Invalid input"},{status:400});let{email:t,password:s}=r.data,i=(await (0,u.Lf)()).collection("users"),n=await i.findOne({email:t});if(!n||!await p().compare(s,n.passwordHash))return a.NextResponse.json({error:"invalid-credentials"},{status:401});let o="sanirud.perera@gmail.com"===n.email?"admin":n.role??"customer",c=(0,d.N)({sub:n._id?.toString(),email:n.email,role:o}),l=a.NextResponse.json({id:n._id?.toString(),email:n.email,role:o,purchaseHistory:n.purchaseHistory??[]});return l.cookies.set("auth_token",c,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800}),l}let x=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"D:\\Programming\\AllegroScore\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:v,serverHooks:h}=x;function w(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:v})}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48378:(e,r,t)=>{"use strict";t.d(r,{J:()=>a,N:()=>o});var s=t(43205),i=t.n(s);let n=process.env.JWT_SECRET;if(!n)throw Error("JWT_SECRET is not set. Add it to .env.local and restart.");function o(e,r="7d"){return i().sign(e,n,{expiresIn:r})}function a(e){try{return i().verify(e,n)}catch{return null}}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75745:(e,r,t)=>{"use strict";t.d(r,{Lf:()=>a,M:()=>u});var s=t(12518);let i=process.env.MONGODB_URI;if(!i)throw Error("MONGODB_URI is not set. Add it to .env.local and restart.");let n=global;async function o(){return n.mongoClientPromise||(n.mongoClientPromise=new s.MongoClient(i).connect()),n.mongoClientPromise}async function a(e=process.env.MONGODB_DB||"allegroscore"){return(await o()).db(e)}async function u(e="files"){let r=await a();return new s.GridFSBucket(r,{bucketName:e})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[719,580,205,18],()=>t(19607));module.exports=s})();