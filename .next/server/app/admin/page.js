(()=>{var e={};e.id=698,e.ids=[698],e.modules={1132:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});let i=(0,a(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Programming\\\\AllegroScore\\\\src\\\\app\\\\admin\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Programming\\AllegroScore\\src\\app\\admin\\page.tsx","default")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12518:e=>{"use strict";e.exports=require("mongodb")},15079:(e,t,a)=>{"use strict";a.d(t,{bq:()=>p,eb:()=>x,gC:()=>h,l6:()=>c,yv:()=>m});var i=a(60687),r=a(43210),s=a(17403),n=a(61662),o=a(89743),l=a(58450),d=a(4780);let c=s.bL;s.YJ;let m=s.WT,p=r.forwardRef(({className:e,children:t,...a},r)=>(0,i.jsxs)(s.l9,{ref:r,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[t,(0,i.jsx)(s.In,{asChild:!0,children:(0,i.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]}));p.displayName=s.l9.displayName;let u=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)(s.PP,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,i.jsx)(o.A,{className:"h-4 w-4"})}));u.displayName=s.PP.displayName;let f=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)(s.wn,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,i.jsx)(n.A,{className:"h-4 w-4"})}));f.displayName=s.wn.displayName;let h=r.forwardRef(({className:e,children:t,position:a="popper",...r},n)=>(0,i.jsx)(s.ZL,{children:(0,i.jsxs)(s.UC,{ref:n,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[(0,i.jsx)(u,{}),(0,i.jsx)(s.LM,{className:(0,d.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,i.jsx)(f,{})]})}));h.displayName=s.UC.displayName,r.forwardRef(({className:e,...t},a)=>(0,i.jsx)(s.JU,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=s.JU.displayName;let x=r.forwardRef(({className:e,children:t,...a},r)=>(0,i.jsxs)(s.q7,{ref:r,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[(0,i.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(s.VF,{children:(0,i.jsx)(l.A,{className:"h-4 w-4"})})}),(0,i.jsx)(s.p4,{children:t})]}));x.displayName=s.q7.displayName,r.forwardRef(({className:e,...t},a)=>(0,i.jsx)(s.wv,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=s.wv.displayName},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27102:(e,t,a)=>{"use strict";a.d(t,{G:()=>i});let i=JSON.parse('{"o":[{"id":"1","description":"Moonlit piano keys","imageUrl":"https://images.unsplash.com/photo-1635476573973-fdb06ca7ad4d?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTV8fHBpYW5vJTIwbXVzaWN8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&q=60&w=500","imageHint":"piano music"},{"id":"2","description":"Violin resting on a score","imageUrl":"https://images.unsplash.com/photo-1701749059090-ac8afdba7b44?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8dmlvbGluJTIwbXVzaWN8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&q=60&w=500","imageHint":"violin music"},{"id":"3","description":"Chopin manuscript","imageUrl":"https://images.unsplash.com/photo-1576325879310-f8d3ad9fa9dc?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTh8fHNoZWV0JTIwbXVzaWN8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&q=60&w=500","imageHint":"sheet music"},{"id":"4","description":"Organ pipes in a cathedral","imageUrl":"https://images.unsplash.com/photo-1600474848954-080e61d18c0d?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8b3JnYW58ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&q=60&w=500","imageHint":"organ bach"},{"id":"5","description":"Classical quartet performance","imageUrl":"https://images.unsplash.com/photo-1492563817904-5f1dc687974f?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8c3RyaW5nJTIwcXVhcnRldHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&q=60&w=500","imageHint":"string quartet"},{"id":"6","description":"A love letter with a piano","imageUrl":"https://images.unsplash.com/photo-1636740940906-aaa7226ee769?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjJ8fHBpYW5vJTIwbGV0dGVyfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=500","imageHint":"piano letter"},{"id":"7","description":"Cello leaning against a chair","imageUrl":"https://images.unsplash.com/photo-1612702610868-5c3895fed2ba?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8Y2VsbG8lMjBtdXNpY3xlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&q=60&w=500","imageHint":"cello music"},{"id":"8","description":"Flute on a wooden table","imageUrl":"https://images.unsplash.com/photo-1666209932578-668a10a2560c?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8Zmx1dGUlMjBjbGFzc2ljfGVufDB8fDB8fHww&auto=format&fit=crop&q=60&w=500","imageHint":"flute classic"},{"id":"9","description":"Spanish guitar in warm light","imageUrl":"https://images.unsplash.com/photo-1697196179502-c59ca6f2e947?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8Z3VpdGFyJTIwY2xhc3NpY3xlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&q=60&w=500","imageHint":"guitar classic"},{"id":"10","description":"Abstract musical notes","imageUrl":"https://images.unsplash.com/photo-1522008224169-e5992bed5fae?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8bXVzaWMlMjBhYnN0cmFjdHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&q=60&w=500","imageHint":"music abstract"},{"id":"admin-upload","description":"Admin uploading files","imageUrl":"https://picsum.photos/seed/11/1200/400","imageHint":"file upload"},{"id":"notation-preview","description":"A preview of sheet music notation","imageUrl":"https://picsum.photos/seed/notation1/600/800","imageHint":"sheet music notation"}]}').o},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32097:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d});var i=a(65239),r=a(48088),s=a(88170),n=a.n(s),o=a(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);a.d(t,l);let d={children:["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,1132)),"D:\\Programming\\AllegroScore\\src\\app\\admin\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,94431)),"D:\\Programming\\AllegroScore\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(a.t.bind(a,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(a.t.bind(a,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["D:\\Programming\\AllegroScore\\src\\app\\admin\\page.tsx"],m={require:a,loadChunk:()=>Promise.resolve()},p=new i.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},33873:e=>{"use strict";e.exports=require("path")},44493:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>n,aR:()=>o,wL:()=>m});var i=a(60687),r=a(43210),s=a(4780);let n=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));n.displayName="Card";let o=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...t}));o.displayName="CardHeader";let l=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));l.displayName="CardTitle";let d=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("text-sm text-muted-foreground",e),...t}));d.displayName="CardDescription";let c=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",e),...t}));c.displayName="CardContent";let m=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",e),...t}));m.displayName="CardFooter"},51617:(e,t,a)=>{"use strict";a.d(t,{eI:()=>r,n9:()=>i});let i=["Piano","Violin","Guitar","Flute","Cello","Organ","String Quartet"],r=["Johann Sebastian Bach","Ludwig van Beethoven","Wolfgang Amadeus Mozart","Fr\xe9d\xe9ric Chopin","Antonio Vivaldi","Franz Liszt","Johann Pachelbel","Claude Debussy","Isaac Alb\xe9niz","Johannes Brahms"]},54300:(e,t,a)=>{"use strict";a.d(t,{J:()=>c});var i=a(60687),r=a(43210),s=a(3416),n=r.forwardRef((e,t)=>(0,i.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var o=a(24224),l=a(4780);let d=(0,o.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)(n,{ref:a,className:(0,l.cn)(d(),e),...t}));c.displayName=n.displayName},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70406:(e,t,a)=>{Promise.resolve().then(a.bind(a,89471))},70440:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var i=a(31658);let r=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,i.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},78654:(e,t,a)=>{Promise.resolve().then(a.bind(a,1132))},79551:e=>{"use strict";e.exports=require("url")},85535:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});let i=(0,a(82614).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},89471:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var i=a(60687),r=a(30474),s=a(29523),n=a(44493),o=a(89667),l=a(54300),d=a(15079),c=a(51617),m=a(27102),p=a(85535),u=a(53597);let f=(0,a(82614).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var h=a(85814),x=a.n(h),g=a(18780),b=a(43210),w=a(16189),j=a(6475);let v=(0,j.createServerReference)("406be1320973afd77a479b23ca26ddefc68fe6e5e7",j.callServer,void 0,j.findSourceMapURL,"addSheetMusic");var y=a(29867);function N(){let e=m.G.find(e=>"admin-upload"===e.id),{user:t,loading:a}=(0,g.A)(),h=(0,w.useRouter)(),{toast:j}=(0,y.dj)(),[N,M]=(0,b.useTransition)(),[A,D]=(0,b.useState)(null),[H,P]=(0,b.useState)(Date.now()),q=t?.role==="admin";return a||!t?(0,i.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-8rem)] text-center p-4",children:(0,i.jsx)("p",{children:"Loading..."})}):q?(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"relative h-64 md:h-80",children:[(0,i.jsx)(r.default,{src:e?.imageUrl??"https://picsum.photos/seed/placeholder/1200/400",alt:"Admin dashboard",fill:!0,priority:!0,className:"object-cover","data-ai-hint":e?.imageHint}),(0,i.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center text-white",children:[(0,i.jsx)(u.A,{className:"w-16 h-16 mx-auto mb-4 text-primary"}),(0,i.jsx)("h1",{className:"text-4xl font-bold font-headline",children:"Admin Panel"}),(0,i.jsx)("p",{className:"text-xl text-white/80",children:"Manage Sheet Music Uploads"})]})})]}),(0,i.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,i.jsxs)(n.Zp,{className:"max-w-2xl mx-auto",children:[(0,i.jsxs)(n.aR,{children:[(0,i.jsx)(n.ZB,{children:"Upload New Sheet Music"}),(0,i.jsx)(n.BT,{children:"Fill out the form to add a new piece to the collection."})]}),(0,i.jsx)(n.Wu,{children:(0,i.jsxs)("form",{className:"grid gap-6",onSubmit:e=>{e.preventDefault();let t=new FormData(e.currentTarget);if(!A)return void j({variant:"destructive",title:"Error",description:"Please select a PDF file to upload."});M(async()=>{let e=await v(t);e.success?(j({title:"Success!",description:e.message}),P(Date.now()),D(null),h.refresh()):j({variant:"destructive",title:"Upload Failed",description:e.message||"Could not add the sheet music. Please try again."})})},children:[(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsx)(l.J,{htmlFor:"title",children:"Piece Title"}),(0,i.jsx)(o.p,{id:"title",name:"title",placeholder:"e.g., Sonata No. 14",required:!0})]}),(0,i.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsx)(l.J,{htmlFor:"composer",children:"Composer"}),(0,i.jsxs)(d.l6,{name:"composer",required:!0,children:[(0,i.jsx)(d.bq,{id:"composer",children:(0,i.jsx)(d.yv,{placeholder:"Select composer"})}),(0,i.jsx)(d.gC,{children:c.eI.map(e=>(0,i.jsx)(d.eb,{value:e,children:e},e))})]})]}),(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsx)(l.J,{htmlFor:"instrument",children:"Instrument"}),(0,i.jsxs)(d.l6,{name:"instrument",required:!0,children:[(0,i.jsx)(d.bq,{id:"instrument",children:(0,i.jsx)(d.yv,{placeholder:"Select instrument"})}),(0,i.jsx)(d.gC,{children:c.n9.map(e=>(0,i.jsx)(d.eb,{value:e,children:e},e))})]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsx)(l.J,{htmlFor:"price",children:"Price ($)"}),(0,i.jsx)(o.p,{id:"price",name:"price",type:"number",placeholder:"e.g., 5.99",required:!0,step:"0.01"})]}),(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsx)(l.J,{htmlFor:"imageId",children:"Cover Image"}),(0,i.jsxs)(d.l6,{name:"imageId",defaultValue:"1",required:!0,children:[(0,i.jsx)(d.bq,{id:"imageId",children:(0,i.jsx)(d.yv,{placeholder:"Select image"})}),(0,i.jsx)(d.gC,{children:m.G.slice(0,9).map(e=>(0,i.jsx)(d.eb,{value:e.id,children:e.description},e.id))})]})]})]}),(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsx)(l.J,{htmlFor:"file",children:"Sheet Music File (PDF)"}),(0,i.jsx)(o.p,{id:"file",name:"file",type:"file",className:"cursor-pointer",accept:".pdf",onChange:e=>{e.target.files&&e.target.files.length>0?D(e.target.files[0]):D(null)},required:!0})]}),(0,i.jsxs)(s.$,{type:"submit",className:"w-full",size:"lg",disabled:N,children:[(0,i.jsx)(f,{className:"mr-2 h-4 w-4"})," ",N?"Adding...":"Add to Collection"]})]},H)})]})})]}):(0,i.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-8rem)] text-center p-4",children:(0,i.jsxs)(n.Zp,{className:"max-w-md p-8",children:[(0,i.jsx)(n.aR,{children:(0,i.jsxs)(n.ZB,{className:"flex items-center justify-center gap-2",children:[(0,i.jsx)(p.A,{className:"w-6 h-6 text-destructive"}),"Access Denied"]})}),(0,i.jsxs)(n.Wu,{children:[(0,i.jsx)("p",{children:"You do not have permission to view this page."}),(0,i.jsx)(s.$,{asChild:!0,className:"mt-6",children:(0,i.jsx)(x(),{href:"/",children:"Go to Homepage"})})]})]})})}},89667:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var i=a(60687),r=a(43210),s=a(4780);let n=r.forwardRef(({className:e,type:t,...a},r)=>(0,i.jsx)("input",{type:t,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...a}));n.displayName="Input"},99412:(e,t,a)=>{"use strict";a.r(t),a.d(t,{"00492daac541d3ad2cb7e829f3d67f6aa655f88bd3":()=>u,"4015146b9814282433eb7b261d859e0ff1b9cc187b":()=>f,"406be1320973afd77a479b23ca26ddefc68fe6e5e7":()=>p,"406fa3e4455bb61e1ba14699a875f2d259d04a36aa":()=>h,"70f5b64b17e81a18c62a2574c405e7dd089325d53e":()=>m});var i=a(91199);a(42087);var r=a(12518);let s=process.env.MONGODB_URI;if(!s)throw Error("MONGODB_URI is not set. Add it to .env.local and restart.");let n=global;async function o(){return n.mongoClientPromise||(n.mongoClientPromise=new r.MongoClient(s).connect()),n.mongoClientPromise}async function l(e=process.env.MONGODB_DB||"allegroscore"){return(await o()).db(e)}async function d(e="files"){let t=await l();return new r.GridFSBucket(t,{bucketName:e})}var c=a(27910);async function m(e,t,a){return console.log(`Processing purchase for ${t} by user ${e}`),await new Promise(e=>setTimeout(e,1500)),console.log(`Purchase successful for ${a}`),{success:!0,message:`Successfully purchased "${a}"!`}}async function p(e){let t=e.get("file"),a=e.get("title"),i=e.get("composer"),r=e.get("instrument"),s=e.get("price"),n=e.get("imageId");if(!t||!a||!i||!r||!s||!n)return{success:!1,message:"Missing required form fields."};try{let e=await d("sheetMusic"),o=`${Date.now()}_${t.name}`,m=e.openUploadStream(o,{contentType:t.type||"application/pdf"}),p=Buffer.from(await t.arrayBuffer());await new Promise((e,t)=>{c.Readable.from(p).pipe(m).on("error",t).on("finish",()=>e())});let u=m.id?.toString(),f=`/api/files/${u}`,h={title:a,composer:i,instrument:r,price:parseFloat(s)||0,imageId:n,downloadUrl:f},x=await l(),g=await x.collection("sheetMusic").insertOne(h);return{success:!0,message:`"${h.title}" has been added with ID: ${g.insertedId.toString()}`}}catch(e){return console.error("Error adding sheet music:",e),{success:!1,message:e.message||"Failed to add sheet music."}}}async function u(){try{let e=await l();return(await e.collection("sheetMusic").find({}).sort({_id:-1}).toArray()).map(e=>({id:e._id.toString(),title:e.title,composer:e.composer,instrument:e.instrument,price:e.price,imageId:e.imageId,downloadUrl:e.downloadUrl}))}catch(e){return console.error("Error fetching sheet music: ",e),[]}}async function f(e){try{let t=await l(),a=await t.collection("sheetMusic").findOne({_id:new r.ObjectId(e)});if(!a)return null;return{id:a._id.toString(),title:a.title,composer:a.composer,instrument:a.instrument,price:a.price,imageId:a.imageId,downloadUrl:a.downloadUrl}}catch(e){return console.error("Error fetching document:",e),null}}async function h(e){if(0===e.length)return[];try{let t=e.map(e=>f(e));return(await Promise.all(t)).filter(e=>null!==e)}catch(e){return console.error("Error fetching purchased music:",e),[]}}(0,a(33331).D)([m,p,u,f,h]),(0,i.A)(m,"70f5b64b17e81a18c62a2574c405e7dd089325d53e",null),(0,i.A)(p,"406be1320973afd77a479b23ca26ddefc68fe6e5e7",null),(0,i.A)(u,"00492daac541d3ad2cb7e829f3d67f6aa655f88bd3",null),(0,i.A)(f,"4015146b9814282433eb7b261d859e0ff1b9cc187b",null),(0,i.A)(h,"406fa3e4455bb61e1ba14699a875f2d259d04a36aa",null)}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[719,524,658,706,576,23],()=>a(32097));module.exports=i})();